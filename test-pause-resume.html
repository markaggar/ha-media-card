<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Card - Pause/Resume Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui;
            margin: 20px; 
            background: #fafafa;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #b6d4d9; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: background 0.2s;
        }
        .primary { background: #007bff; color: white; }
        .primary:hover { background: #0056b3; }
        .secondary { background: #6c757d; color: white; }
        .secondary:hover { background: #545b62; }
        #logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Media Card - Pause/Resume Test</h1>
        <p>Testing the fixed pause/resume functionality in random mode.</p>
        
        <div class="status info">
            <strong>Instructions:</strong><br>
            1. Click the center area to pause/resume<br>
            2. Press 'P' key to pause/resume<br>
            3. Watch the console logs to verify timer behavior
        </div>
        
        <div class="controls">
            <button class="primary" onclick="enableDebugMode()">Enable Debug Mode</button>
            <button class="secondary" onclick="simulatePause()">Test Pause</button>
            <button class="secondary" onclick="simulateResume()">Test Resume</button>
            <button class="secondary" onclick="clearLogs()">Clear Logs</button>
        </div>
        
        <div id="test-results">
            <div class="info">üîÑ Setting up test...</div>
        </div>
        
        <h3>Debug Logs:</h3>
        <div id="logs"></div>
        
        <div id="card-container" style="margin-top: 20px;">
            <!-- Media card will be rendered here -->
        </div>
    </div>

    <script type="module">
        let card;
        let logElement;
        
        // Intercept console.log to show logs in the UI
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, arguments);
            if (logElement) {
                logElement.textContent += args.join(' ') + '\n';
                logElement.scrollTop = logElement.scrollHeight;
            }
        };
        
        window.enableDebugMode = function() {
            if (card) {
                card._debugMode = true;
                addLog('üîß Debug mode enabled');
            }
        };
        
        window.simulatePause = function() {
            if (card && card._isRandomMode()) {
                const wasPaused = card._isPaused;
                card._isPaused = true;
                card._log('üéÆ Simulated pause');
                if (card._refreshInterval) {
                    clearInterval(card._refreshInterval);
                    card._refreshInterval = null;
                    addLog('‚úÖ Auto-refresh timer cleared');
                }
                card.requestUpdate();
            }
        };
        
        window.simulateResume = function() {
            if (card && card._isRandomMode()) {
                card._isPaused = false;
                card._log('üéÆ Simulated resume');
                card._setupAutoRefresh();
                addLog('‚úÖ Auto-refresh timer restarted');
                card.requestUpdate();
            }
        };
        
        window.clearLogs = function() {
            if (logElement) {
                logElement.textContent = '';
            }
        };
        
        function addLog(message) {
            if (logElement) {
                logElement.textContent += message + '\n';
                logElement.scrollTop = logElement.scrollHeight;
            }
        }
        
        try {
            // Import the media card
            await import('./ha-media-card.js');
            
            // Set up logging
            logElement = document.getElementById('logs');
            
            // Create card instance
            card = document.createElement('ha-media-card');
            
            // Mock Home Assistant object with media browser functionality
            const mockHass = {
                callService: () => Promise.resolve(),
                callWS: (params) => {
                    if (params.type === 'media_source/browse_media') {
                        // Return mock folder with multiple images
                        return Promise.resolve({
                            children: [
                                { 
                                    title: 'Test Image 1.jpg',
                                    media_content_id: 'media-source://media_source/local/test1.jpg',
                                    can_expand: false,
                                    media_content_type: 'image/jpeg'
                                },
                                { 
                                    title: 'Test Image 2.jpg',
                                    media_content_id: 'media-source://media_source/local/test2.jpg',
                                    can_expand: false,
                                    media_content_type: 'image/jpeg'
                                },
                                { 
                                    title: 'Test Image 3.jpg',
                                    media_content_id: 'media-source://media_source/local/test3.jpg',
                                    can_expand: false,
                                    media_content_type: 'image/jpeg'
                                }
                            ]
                        });
                    }
                    
                    if (params.type === 'media_source/resolve_media') {
                        // Return mock resolved URL
                        return Promise.resolve({
                            url: `/local/mock_image_${Date.now()}.jpg`,
                            mime_type: 'image/jpeg'
                        });
                    }
                    
                    return Promise.resolve({ children: [] });
                }
            };
            
            // Configure for random folder mode with auto-refresh
            const testConfig = {
                title: 'Pause/Resume Test',
                media_path: 'media-source://media_source/local/test_folder',
                media_type: 'image',
                is_folder: true,
                folder_mode: 'random',
                auto_refresh_seconds: 3,  // Fast refresh for testing
                show_refresh_button: true,
                enable_navigation_zones: true
            };
            
            // Set up the card
            card.hass = mockHass;
            card.setConfig(testConfig);
            card._debugMode = true; // Enable debug logging
            
            // Add to DOM
            document.getElementById('card-container').appendChild(card);
            
            // Test results
            const tests = [
                {
                    name: 'Card setup',
                    passed: card.config.folder_mode === 'random',
                    message: 'Card configured for random mode'
                },
                {
                    name: 'Pause state',
                    passed: card._isPaused === false,
                    message: 'Initially not paused'
                },
                {
                    name: 'Helper methods',
                    passed: typeof card._isRandomMode === 'function',
                    message: 'Random mode helper available'
                }
            ];
            
            let results = '<h3>‚úÖ Test Setup Results</h3>';
            let allPassed = true;
            
            for (const test of tests) {
                if (test.passed) {
                    results += `<div class="success">‚úÖ ${test.name}: ${test.message}</div>`;
                } else {
                    results += `<div class="error">‚ùå ${test.name}: ${test.message}</div>`;
                    allPassed = false;
                }
            }
            
            if (allPassed) {
                results += '<div class="success"><strong>üéâ Ready for pause/resume testing!</strong></div>';
                results += '<div class="warning"><strong>üìù Note:</strong> Click the center area of the card or press "P" to test pause/resume. Check the logs to verify the timer behavior.</div>';
            }
            
            document.getElementById('test-results').innerHTML = results;
            
            addLog('üöÄ Test setup complete');
            addLog('üìã Card configured for random folder mode with 3s auto-refresh');
            addLog('üéÆ Click center area or press P to test pause/resume');
            
        } catch (error) {
            document.getElementById('test-results').innerHTML = 
                `<div class="error">‚ùå Failed to set up test: ${error.message}</div>`;
            console.error('Test setup error:', error);
        }
    </script>
</body>
</html>
